<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 Ìïú-ÌïÑ Îã¨Î†•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');
        body { font-family: 'Pretendard', sans-serif; -webkit-tap-highlight-color: transparent; }
        .calendar-cell { min-height: 95px; transition: all 0.2s; border-bottom: 1px solid #f1f5f9; border-right: 1px solid #f1f5f9; }
        @media (max-width: 640px) { .calendar-cell { min-height: 85px; } }
        .todo-done { text-decoration: line-through; color: #cbd5e1; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .animate-in { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Íµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å ÏÑ§Ï†ï
        const CLIENT_ID = '314931997732-1bf05smib05uh54cr4d1fnpurb85emln.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        const holidayData = {
            '2026-01-01': { kr: 'Ïã†Ï†ï', ph: "New Year's Day" },
            '2026-01-17': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-01-31': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-02-14': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-02-16': { kr: 'ÏÑ§ÎÇ† Ï†ÑÎÇ†', ph: 'OFFÌÜ†ÏöîÏùº ÎåÄÏ≤¥' },
            '2026-02-17': { kr: 'ÏÑ§ÎÇ†', ph: 'Chinese New Year' },
            '2026-02-18': { kr: 'ÏÑ§ÎÇ† Îã§ÏùåÎÇ†' },
            '2026-03-01': { kr: 'ÏÇºÏùºÏ†à' },
            '2026-03-02': { kr: 'ÏÇºÏùºÏ†à ÎåÄÏ≤¥Í≥µÌú¥Ïùº' },
            '2026-03-14': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-03-20': { ph: 'Eid al-Fitr' },
            '2026-03-28': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-04-02': { ph: 'Maundy Thursday' },
            '2026-04-03': { ph: 'Good Friday' },
            '2026-04-04': { ph: 'Black Saturday' },
            '2026-04-09': { ph: 'Araw ng Kagitingan' },
            '2026-04-11': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-04-25': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-05-01': { ph: 'Labor Day' },
            '2026-05-05': { kr: 'Ïñ¥Î¶∞Ïù¥ÎÇ†' },
            '2026-05-09': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-05-23': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-05-24': { kr: 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº' },
            '2026-05-26': { kr: 'ÏÑùÍ∞ÄÌÉÑÏã†Ïùº ÎåÄÏ≤¥Í≥µÌú¥Ïùº' },
            '2026-05-27': { ph: 'Eid al-Adha' },
            '2026-06-06': { kr: 'ÌòÑÏ∂©Ïùº' },
            '2026-06-12': { ph: 'Independence Day' },
            '2026-06-20': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-07-04': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-07-17': { kr: 'Ï†úÌóåÏ†à' },
            '2026-07-18': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-08-01': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-08-15': { kr: 'Í¥ëÎ≥µÏ†à' },
            '2026-08-28': { ph: 'ÎåÄÏ≤¥Ìú¥Ïùº-Ninoy Aquino Day' },
            '2026-08-29': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-08-31': { ph: "National Heroes' Day" },
            '2026-09-12': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-09-24': { kr: 'Ï∂îÏÑù Ï†ÑÎÇ†' },
            '2026-09-25': { kr: 'Ï∂îÏÑù' },
            '2026-09-26': { kr: 'Ï∂îÏÑù Îã§ÏùåÎÇ†' },
            '2026-10-03': { kr: 'Í∞úÏ≤úÏ†à' },
            '2026-10-06': { kr: 'Í∞úÏ≤úÏ†à ÎåÄÏ≤¥Í≥µÌú¥Ïùº' },
            '2026-10-09': { kr: 'ÌïúÍ∏ÄÎÇ†' },
            '2026-10-10': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-10-24': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-11-01': { ph: "All Saints' Day" },
            '2026-11-02': { ph: "All Souls' Day" },
            '2026-11-07': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-11-21': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-11-30': { ph: 'Bonifacio Day' },
            '2026-12-05': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-12-19': { ph: 'OFF ÌÜ†ÏöîÏùº' },
            '2026-12-24': { ph: 'Christmas Eve' },
            '2026-12-25': { kr: 'ÌÅ¨Î¶¨Ïä§ÎßàÏä§', ph: 'Christmas Day' },
            '2026-12-26': { ph: 'ÎåÄÏ≤¥Ìú¥Ïùº-Immaculate Conception' },
            '2026-12-30': { ph: 'Rizal Day' },
            '2026-12-31': { ph: 'Last Day of the Year' }
        };

        // Íµ¨Í∏Ä ÎìúÎùºÏù¥Î∏å Ìó¨Ìçº Ìï®Ïàò
        const uploadFile = async (token, name, content, type) => {
            const searchRes = await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${name}'&fields=files(id)`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            const searchData = await searchRes.json();
            const fileId = searchData.files?.[0]?.id;
            
            const metadata = { name, mimeType: type };
            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', new Blob([content], { type }));

            const url = fileId 
                ? `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`
                : 'https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart';
            
            return fetch(url, {
                method: fileId ? 'PATCH' : 'POST',
                headers: { Authorization: `Bearer ${token}` },
                body: form
            });
        };

        const downloadFile = async (token, name) => {
            const searchRes = await fetch(`https://www.googleapis.com/drive/v3/files?q=name='${name}'&fields=files(id)`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            const searchData = await searchRes.json();
            if (!searchData.files?.length) return null;
            
            const fileRes = await fetch(`https://www.googleapis.com/drive/v3/files/${searchData.files[0].id}?alt=media`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            return await fileRes.text();
        };

        const App = () => {
            const [month, setMonth] = useState(new Date().getMonth());
            const [todos, setTodos] = useState({});
            const [modal, setModal] = useState(null);
            const [viewImage, setViewImage] = useState(null);
            const [syncStatus, setSyncStatus] = useState('');

            // Ï¥àÍ∏∞ Î°úÏª¨ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            useEffect(() => {
                const saved = localStorage.getItem('calendar_v2026');
                if (saved) try { setTodos(JSON.parse(saved)); } catch(e) {}
            }, []);

            // [ÏàòÏ†ï] ÎîîÎ∞îÏö¥Ïã± Ï†ÄÏû• Î°úÏßÅ (ÏÇ¨ÌååÎ¶¨ ÌäïÍπÄ Î∞©ÏßÄ)
            useEffect(() => {
                const timer = setTimeout(() => {
                    try {
                        localStorage.setItem('calendar_v2026', JSON.stringify(todos));
                    } catch (e) {
                        console.error("Ï†ÄÏû•Ïö©Îüâ Ï¥àÍ≥º", e);
                    }
                }, 800);
                return () => clearTimeout(timer);
            }, [todos]);

            const handleDriveSync = (mode) => {
                const client = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: async (res) => {
                        if (res.access_token) {
                            try {
                                setSyncStatus(mode === 'load' ? 'Î∂àÎü¨Ïò§Îäî Ï§ë...' : 'Ï†ÄÏû• Ï§ë...');
                                if (mode === 'load') {
                                    const data = await downloadFile(res.access_token, 'calendar_2026.json');
                                    if (data) {
                                        setTodos(JSON.parse(data));
                                        setSyncStatus('‚úì ÎèôÍ∏∞Ìôî ÏôÑÎ£å');
                                    }
                                } else {
                                    await uploadFile(res.access_token, 'calendar_2026.json', JSON.stringify(todos), 'application/json');
                                    setSyncStatus('‚úì Ï†ÄÏû• ÏôÑÎ£å');
                                }
                            } catch (e) {
                                setSyncStatus('‚ùå Ïã§Ìå®');
                            } finally {
                                setTimeout(() => setSyncStatus(''), 2000);
                            }
                        }
                    }
                });
                client.requestAccessToken({ prompt: mode === 'load' ? '' : 'consent' });
            };

            const fmt = (m, d) => `2026-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
            const daysInMonth = new Date(2026, month + 1, 0).getDate();
            const startDay = new Date(2026, month, 1).getDay();

            return (
                <div className="max-w-md mx-auto p-4 min-h-screen pb-20">
                    <div className="flex justify-between items-center mb-6 bg-white p-4 rounded-2xl shadow-sm border border-slate-100">
                        <button onClick={() => setMonth(m => m > 0 ? m - 1 : 11)} className="p-2 text-slate-400">‚óÄ</button>
                        <div className="text-center">
                            <h1 className="text-xl font-bold">2026ÎÖÑ {month + 1}Ïõî</h1>
                            {syncStatus && <div className="text-[10px] text-sky-500 font-bold">{syncStatus}</div>}
                        </div>
                        <button onClick={() => setMonth(m => m < 11 ? m + 1 : 0)} className="p-2 text-slate-400">‚ñ∂</button>
                    </div>

                    <div className="flex gap-2 mb-6">
                        <button onClick={() => handleDriveSync('load')} className="flex-1 bg-white border border-slate-200 py-3 rounded-2xl text-xs font-bold shadow-sm active:scale-95 transition-transform">‚òÅÔ∏è Î∂àÎü¨Ïò§Í∏∞</button>
                        <button onClick={() => handleDriveSync('save')} className="flex-1 bg-slate-900 text-white py-3 rounded-2xl text-xs font-bold shadow-sm active:scale-95 transition-transform">üíæ ÌÅ¥ÎùºÏö∞Îìú Ï†ÄÏû•</button>
                    </div>

                    <div className="bg-white rounded-3xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="grid grid-cols-7 bg-slate-50/50 py-3 text-center text-[10px] font-bold text-slate-400 border-b border-slate-100">
                            {['SUN','MON','TUE','WED','THU','FRI','SAT'].map(d => <div key={d}>{d}</div>)}
                        </div>
                        <div className="grid grid-cols-7">
                            {[...Array(startDay)].map((_, i) => <div key={`e-${i}`} className="calendar-cell bg-slate-50/30" />)}
                            {[...Array(daysInMonth)].map((_, i) => {
                                const d = i + 1;
                                const dateStr = fmt(month, d);
                                const h = holidayData[dateStr];
                                const isSun = new Date(2026, month, d).getDay() === 0;
                                const dayTodos = todos[dateStr] || [];

                                return (
                                    <div key={d} onClick={() => setModal(dateStr)} className="calendar-cell p-1 cursor-pointer active:bg-slate-50 relative">
                                        <div className="flex flex-col h-full">
                                            <span className={`text-sm font-semibold ${isSun || h?.kr ? 'text-rose-500' : 'text-slate-600'}`}>{d}</span>
                                            {h && (
                                                <div className="text-[8px] leading-tight mt-0.5">
                                                    {h.kr && <div className="text-rose-400 font-bold break-keep">{h.kr}</div>}
                                                    {h.ph && <div className="text-sky-500 font-medium break-keep line-clamp-1">{h.ph}</div>}
                                                </div>
                                            )}
                                            <div className="mt-auto flex flex-wrap gap-0.5">
                                                {dayTodos.slice(0, 3).map(t => (
                                                    <div key={t.id} className={`w-1 h-1 rounded-full ${t.done ? 'bg-slate-300' : 'bg-sky-400'}`} />
                                                ))}
                                                {dayTodos.length > 3 && <div className="text-[7px] text-slate-400">+</div>}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    {modal && <Modal date={modal} onClose={() => setModal(null)} todos={todos} setTodos={setTodos} setViewImage={setViewImage} />}
                    {viewImage && (
                        <div onClick={() => setViewImage(null)} className="fixed inset-0 bg-black/90 flex items-center justify-center z-[70] p-4">
                            <img src={viewImage} className="max-w-full max-h-full object-contain rounded-lg" />
                        </div>
                    )}
                </div>
            );
        };

        const Modal = ({ date, onClose, todos, setTodos, setViewImage }) => {
            const [text, setText] = useState('');
            const [image, setImage] = useState(null);
            const [loading, setLoading] = useState(false);

            // [ÏàòÏ†ï] Ïù¥ÎØ∏ÏßÄ ÏïïÏ∂ï (ÏµúÎåÄ 600px, ÌíàÏßà 0.5)
            const handleImage = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setLoading(true);
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX = 600;
                        let w = img.width, h = img.height;
                        if (w > h && w > MAX) { h *= MAX/w; w = MAX; }
                        else if (h > MAX) { w *= MAX/h; h = MAX; }
                        canvas.width = w; canvas.height = h;
                        canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                        setImage(canvas.toDataURL('image/jpeg', 0.5));
                        setLoading(false);
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            };

            const add = () => {
                if (!text && !image) return;
                const newItem = { id: Date.now(), text, image, done: false };
                setTodos(prev => ({ ...prev, [date]: [...(prev[date] || []), newItem] }));
                setText(''); setImage(null);
            };

            const toggle = (id) => {
                setTodos(prev => ({
                    ...prev,
                    [date]: prev[date].map(t => t.id === id ? { ...t, done: !t.done } : t)
                }));
            };

            const del = (id) => {
                setTodos(prev => {
                    const filtered = prev[date].filter(t => t.id !== id);
                    const update = { ...prev };
                    if (filtered.length) update[date] = filtered; else delete update[date];
                    return update;
                });
            };

            return (
                <div className="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-end z-50" onClick={onClose}>
                    <div className="bg-white w-full rounded-t-[32px] p-6 pb-10 animate-in max-h-[90vh] overflow-y-auto hide-scrollbar" onClick={e => e.stopPropagation()}>
                        <div className="w-12 h-1 bg-slate-200 rounded-full mx-auto mb-6" onClick={onClose} />
                        <h2 className="text-xl font-bold mb-4">{date.split('-')[1]}Ïõî {date.split('-')[2]}Ïùº</h2>
                        
                        <div className="space-y-3 mb-6">
                            {(todos[date] || []).map(t => (
                                <div key={t.id} className="flex items-center gap-3 p-3 bg-slate-50 rounded-2xl border border-slate-100">
                                    <div onClick={() => toggle(t.id)} className={`w-5 h-5 rounded-full border-2 flex items-center justify-center ${t.done ? 'bg-sky-500 border-sky-500' : 'border-slate-300'}`}>
                                        {t.done && <span className="text-white text-[10px]">‚úì</span>}
                                    </div>
                                    <div className="flex-1 min-w-0" onClick={() => t.image && setViewImage(t.image)}>
                                        <div className={`text-sm ${t.done ? 'text-slate-400 line-through' : 'font-medium'}`}>{t.text}</div>
                                        {t.image && <div className="text-[10px] text-sky-500 font-bold mt-1">üñºÔ∏è ÏÇ¨ÏßÑ Î≥¥Í∏∞</div>}
                                    </div>
                                    <button onClick={() => del(t.id)} className="text-slate-300 px-2 text-lg">√ó</button>
                                </div>
                            ))}
                        </div>

                        <div className="bg-slate-50 p-4 rounded-3xl space-y-3">
                            <input value={text} onChange={e => setText(e.target.value)} placeholder="Î©îÎ™®Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" className="w-full bg-transparent outline-none text-sm font-medium" />
                            <div className="flex items-center justify-between border-t border-slate-200 pt-3">
                                <label className="flex items-center gap-2 text-slate-400 cursor-pointer active:opacity-50">
                                    <span className="text-xl">üì∑</span>
                                    <span className="text-xs font-bold">{loading ? 'ÏïïÏ∂ï Ï§ë...' : image ? 'ÏÑ†ÌÉùÎê®' : 'ÏÇ¨ÏßÑ'}</span>
                                    <input type="file" accept="image/*" onChange={handleImage} className="hidden" />
                                </label>
                                <button onClick={add} className="bg-slate-900 text-white px-6 py-2 rounded-xl text-xs font-bold">Ï∂îÍ∞Ä</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
